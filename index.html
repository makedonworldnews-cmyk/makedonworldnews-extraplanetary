<script>
// 1. –¢–≤–æ–∏—Ç–µ –∏–∑–≤–æ—Ä–∏ (–ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –ª–∏–Ω–∫–æ–≤–∏—Ç–µ —Å–µ —Ç–æ—á–Ω–∏)
const RSS_SOURCES = [
    { name: "Sitel", url: "https://www.sitel.com.mk/feed", region: "üèîÔ∏è –ë–∞–ª–∫–∞–Ω" },
    { name: "MIA", url: "https://www.mia.mk/rss", region: "üèîÔ∏è –ë–∞–ª–∫–∞–Ω" },
    { name: "BBC World", url: "https://feeds.bbci.co.uk/news/world/rss.xml", region: "üåç World" }
];

const GRADIENTS = ['var(--g1)', 'var(--g2)', 'var(--g3)', 'var(--g4)', 'var(--g5)'];
let allArticles = [];
let currentRegion = 'all';

// 2. –ë–ï–ó–ë–ï–î–ï–ù –°–ê–ê–¢ (–ù–µ –∫–æ—á–∏ –∞–∫–æ –Ω–µ–º–∞ –µ–ª–µ–º–µ–Ω—Ç 'clock')
setInterval(() => {
    const clockEl = document.getElementById('clock');
    if (clockEl) clockEl.textContent = new Date().toLocaleTimeString('mk-MK');
}, 1000);

async function loadNews() {
    const newsGrid = document.getElementById('newsGrid');
    if (!newsGrid) return; // –ê–∫–æ –Ω–µ–º–∞ –∫–∞–¥–µ –¥–∞ —Ü—Ä—Ç–∞, –ø—Ä–µ–∫–∏–Ω–∏ —Ç—É–∫–∞ –±–µ–∑ –≥—Ä–µ—à–∫–∞

    const proxy = "https://api.allorigins.win/get?url=";
    newsGrid.innerHTML = '<div class="empty"><h3>üì° –°–∫–µ–Ω–∏—Ä–∞–º —Ñ—Ä–µ–∫–≤–µ–Ω—Ü–∏–∏...</h3></div>';
    
    allArticles = [];

    for (let src of RSS_SOURCES) {
        try {
            const res = await fetch(proxy + encodeURIComponent(src.url));
            const data = await res.json();
            const parser = new DOMParser();
            const xml = parser.parseFromString(data.contents, "text/xml");
            const items = xml.querySelectorAll("item");

            items.forEach((item, i) => {
                if (i < 5) { // –¢–æ–ø 5 –æ–¥ —Å–µ–∫–æ—ò –∏–∑–≤–æ—Ä
                    allArticles.push({
                        title: item.querySelector("title")?.textContent || "–í–µ—Å—Ç",
                        link: item.querySelector("link")?.textContent || "#",
                        summary: item.querySelector("description")?.textContent?.replace(/<[^>]*>?/gm, '').substring(0, 120),
                        source_name: src.name,
                        region: src.region,
                        published: item.querySelector("pubDate")?.textContent,
                        category: "–ò–ù–§–û"
                    });
                }
            });
        } catch (e) {
            console.log("–ü—Ä–æ–±–ª–µ–º —Å–æ –∏–∑–≤–æ—Ä–æ—Ç: " + src.name);
        }
    }

    // –ë–ï–ó–ë–ï–î–ù–û –ê–ñ–£–†–ò–†–ê–ä–ï –ù–ê –ë–†–û–à–ö–ò
    const updateEl = (id, val) => {
        const el = document.getElementById(id);
        if (el) el.textContent = val;
    };

    updateEl('articleCount', allArticles.length);
    updateEl('nAll', allArticles.length);
    updateEl('countAll', allArticles.length);

    renderNews();
    renderTicker();
}

function renderNews() {
    const newsGrid = document.getElementById('newsGrid');
    if (!newsGrid) return;

    let filtered = allArticles;
    if (currentRegion !== 'all') {
        filtered = allArticles.filter(a => a.region.includes(currentRegion));
    }

    newsGrid.innerHTML = filtered.map((a, i) => `
        <div class="nc" onclick="window.open('${a.link}', '_blank')">
            <div class="nc-img" style="background:${GRADIENTS[i % 5]}">
                <span class="emo">üì∞</span>
                <div class="nc-bdg">${a.category}</div>
                <div class="nc-src-badge">${a.source_name}</div>
            </div>
            <div class="nc-body">
                <div class="nc-meta">üìÖ ${new Date(a.published).toLocaleDateString('mk-MK')}</div>
                <h3 class="nc-ttl">${a.title}</h3>
                <p class="nc-exc">${a.summary}...</p>
                <div class="nc-ft">
                    <span class="nc-src">üì° ${a.source_name}</span>
                    <button class="nc-link">–ü—Ä–æ—á–∏—Ç–∞—ò ‚Üí</button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderTicker() {
    const ticker = document.getElementById('ticker');
    if (ticker && allArticles.length > 0) {
        const items = allArticles.slice(0, 8).map(a => `<span class="tick-i">‚ö° ${a.title}</span>`).join('');
        ticker.innerHTML = items + items;
    }
}

// 3. –ì–õ–ê–í–ù–û –°–¢–ê–†–¢–£–í–ê–ä–ï - –ß–ï–ö–ê –¶–ï–õ HTML –î–ê –°–ï –í–ö–õ–£–ß–ò
window.onload = () => {
    // –ë–µ–∑–±–µ–¥–Ω–æ –¥–æ–¥–∞–≤–∞—ö–µ –Ω–∞ –∫–ª–∏–∫ –∑–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏—ò–∞
    const navBar = document.getElementById('navBar');
    if (navBar) {
        navBar.addEventListener('click', e => {
            const btn = e.target.closest('.nav-btn');
            if (!btn) return;
            currentRegion = btn.dataset.r;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('on', b === btn));
            renderNews();
        });
    }

    // –°—Ç–∞—Ä—Ç—É–≤–∞—ò –≥–∏ –≤–µ—Å—Ç–∏—Ç–µ
    loadNews();
};
</script>
