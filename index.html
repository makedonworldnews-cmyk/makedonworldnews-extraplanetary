<script>
// –¢–≤–æ–∏—Ç–µ –∏–∑–≤–æ—Ä–∏
const RSS_SOURCES = [
    { name: "Sitel", url: "https://www.sitel.com.mk/feed", region: "üèîÔ∏è –ë–∞–ª–∫–∞–Ω" },
    { name: "MIA", url: "https://www.mia.mk/rss", region: "üèîÔ∏è –ë–∞–ª–∫–∞–Ω" },
    { name: "BBC World", url: "https://feeds.bbci.co.uk/news/world/rss.xml", region: "üåç World" }
];

const GRADIENTS = ['var(--g1)', 'var(--g2)', 'var(--g3)', 'var(--g4)', 'var(--g5)'];
let allArticles = [];
let currentRegion = 'all';

// –ë–µ–∑–±–µ–¥–µ–Ω —Å–∞–∞—Ç (–ø—Ä–æ–≤–µ—Ä—É–≤–∞ –¥–∞–ª–∏ –ø–æ—Å—Ç–æ–∏ 'clock' –ø—Ä–µ–¥ –¥–∞ –ø–∏—à–µ)
setInterval(() => {
    const clockEl = document.getElementById('clock');
    if (clockEl) clockEl.textContent = new Date().toLocaleTimeString('mk-MK');
}, 1000);

async function loadNews() {
    const newsGrid = document.getElementById('newsGrid');
    if (!newsGrid) return; // –ê–∫–æ –Ω–µ–º–∞ –∫–∞–¥–µ –¥–∞ –≥–∏ —Ü—Ä—Ç–∞ –≤–µ—Å—Ç–∏—Ç–µ, –Ω–µ –ø—Ä–∞–≤–∏ –Ω–∏—à—Ç–æ

    const proxy = "https://api.allorigins.win/get?url=";
    newsGrid.innerHTML = '<div class="empty"><h3>üì° –ü–æ–≤—Ä–∑—É–≤–∞—ö–µ —Å–æ —Å–∞—Ç–µ–ª–∏—Ç...</h3></div>';
    
    allArticles = [];

    for (let src of RSS_SOURCES) {
        try {
            const res = await fetch(proxy + encodeURIComponent(src.url));
            const data = await res.json();
            const parser = new DOMParser();
            const xml = parser.parseFromString(data.contents, "text/xml");
            const items = xml.querySelectorAll("item");

            items.forEach((item, i) => {
                if (i < 5) {
                    allArticles.push({
                        title: item.querySelector("title")?.textContent || "–ë–µ–∑ –Ω–∞—Å–ª–æ–≤",
                        link: item.querySelector("link")?.textContent || "#",
                        summary: item.querySelector("description")?.textContent?.replace(/<[^>]*>?/gm, '').substring(0, 120),
                        source_name: src.name,
                        region: src.region,
                        published: item.querySelector("pubDate")?.textContent,
                        category: "–í–ï–°–¢–ò"
                    });
                }
            });
        } catch (e) {
            console.log("–ì—Ä–µ—à–∫–∞ —Å–æ: " + src.name);
        }
    }

    // –ë–ï–ó–ë–ï–î–ù–û –∞–∂—É—Ä–∏—Ä–∞—ö–µ –Ω–∞ –±—Ä–æ—ò—á–∞–Ω–∏—Ü–∏—Ç–µ (–∞–∫–æ –≥–∏ –Ω–µ–º–∞, –Ω–µ–º–∞ –¥–∞ –∑–∞–∫–æ—á–∏ –∫–æ–¥–æ—Ç)
    const countEl = document.getElementById('articleCount');
    if (countEl) countEl.textContent = allArticles.length;
    
    const nAllEl = document.getElementById('nAll');
    if (nAllEl) nAllEl.textContent = allArticles.length;

    renderNews();
    renderTicker();
}

function renderNews() {
    const newsGrid = document.getElementById('newsGrid');
    if (!newsGrid) return;

    let filtered = allArticles;
    if (currentRegion !== 'all') {
        filtered = allArticles.filter(a => a.region.includes(currentRegion));
    }

    newsGrid.innerHTML = filtered.map((a, i) => `
        <div class="nc" onclick="window.open('${a.link}', '_blank')">
            <div class="nc-img" style="background:${GRADIENTS[i % 5]}">
                <span class="emo">üì∞</span>
                <div class="nc-bdg">${a.category}</div>
                <div class="nc-src-badge">${a.source_name}</div>
            </div>
            <div class="nc-body">
                <div class="nc-meta">üìÖ ${new Date(a.published).toLocaleDateString('mk-MK')}</div>
                <h3 class="nc-ttl">${a.title}</h3>
                <p class="nc-exc">${a.summary}...</p>
                <div class="nc-ft">
                    <span class="nc-src">üì° ${a.source_name}</span>
                    <button class="nc-link">–ü—Ä–æ—á–∏—Ç–∞—ò ‚Üí</button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderTicker() {
    const ticker = document.getElementById('ticker');
    if (ticker) {
        const items = allArticles.slice(0, 8).map(a => `<span class="tick-i">‚ö° ${a.title}</span>`).join('');
        ticker.innerHTML = items + items;
    }
}

// –ë–ï–ó–ë–ï–î–ù–ò –õ–ò–°–¢–ï–ù–ï–†–ò (addEventListener)
window.addEventListener('load', () => {
    const navBar = document.getElementById('navBar');
    if (navBar) {
        navBar.addEventListener('click', e => {
            const btn = e.target.closest('.nav-btn');
            if (!btn) return;
            currentRegion = btn.dataset.r;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('on', b === btn));
            renderNews();
        });
    }

    const catList = document.getElementById('catList');
    if (catList) {
        catList.addEventListener('click', () => { /* —Ç–≤–æ—ò–∞—Ç–∞ –ª–æ–≥–∏–∫–∞ */ });
    }

    loadNews();
});
</script>
