<script>
// –¢–≤–æ—ò–æ—Ç –∑–ª–∞—Ç–µ–Ω —Å–ø–∏—Å–æ–∫ –Ω–∞ –∏–∑–≤–æ—Ä–∏ (—Å–∫—Ä–∞—Ç–µ–Ω –∑–∞ –ø—Ä–∏–º–µ—Ä, –¥–æ–¥–∞—ò –≥–∏ —Å–∏—Ç–µ —Ç–≤–æ–∏)
const RSS_SOURCES = [
    { "name": "Sitel", "url": "https://www.sitel.com.mk/feed", "region": "üá≤üá∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞" },
    { "name": "Telma", "url": "https://telma.com.mk/feed", "region": "üá≤üá∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞" },
    { "name": "MIA", "url": "https://www.mia.mk/rss", "region": "üá≤üá∞ –ú–∞–∫–µ–¥–æ–Ω–∏—ò–∞" },
    { "name": "BBC World", "url": "https://feeds.bbci.co.uk/news/world/rss.xml", "region": "üåç World" },
    { "name": "CNN", "url": "https://feeds.cnn.com/rss/edition.rss", "region": "üåç World" },
    { "name": "OpenAI", "url": "https://openai.com/news/rss.xml", "region": "ü§ñ AI" }
    // –°–õ–û–ë–û–î–ù–û –î–û–î–ê–à –ì–ò –°–ò–¢–ï –û–°–¢–ê–ù–ê–¢–ò –û–î –¢–í–û–à–û–¢ –õ–ò–°–¢ –¢–£–ö–ê
];

const GRADIENTS = ['var(--g1)', 'var(--g2)', 'var(--g3)', 'var(--g4)', 'var(--g5)'];
let allArticles = [];
let currentRegion = 'all';

// –°–∞–∞—Ç –≤–æ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ
setInterval(() => {
    document.getElementById('clock').textContent = new Date().toLocaleTimeString('mk-MK');
}, 1000);

// –ì–õ–ê–í–ù–ê –§–£–ù–ö–¶–ò–à–ê –ó–ê –í–õ–ï–ß–ï–ä–ï –í–ï–°–¢–ò
async function loadNews() {
    const proxy = "https://api.allorigins.win/get?url=";
    const newsGrid = document.getElementById('newsGrid');
    
    // –ü–æ–∫–∞–∂–∏ –¥–µ–∫–∞ —Ä–∞–±–æ—Ç–∏–º–µ
    newsGrid.innerHTML = '<div class="empty"><div class="empty-ico">üì°</div><h3>–°–µ –≤–æ—Å–ø–æ—Å—Ç–∞–≤—É–≤–∞ —Å–∞—Ç–µ–ª–∏—Ç—Å–∫–∞ –≤—Ä—Å–∫–∞...</h3></div>';
    
    allArticles = []; // –ß–∏—Å—Ç–∏–º–µ —Å—Ç–∞—Ä–∏ –≤–µ—Å—Ç–∏

    // –ó–µ–º–∏ –≥–∏ –ø—Ä–≤–∏—Ç–µ 15 –∏–∑–≤–æ—Ä–∏ (–∑–∞ –¥–∞ –Ω–µ –∫–æ—á–∏)
    const activeSources = RSS_SOURCES.slice(0, 15); 

    for (let source of activeSources) {
        try {
            const targetUrl = encodeURIComponent(source.url);
            const res = await fetch(`${proxy}${targetUrl}`);
            const data = await res.json();
            
            const parser = new DOMParser();
            const xml = parser.parseFromString(data.contents, "text/xml");
            const items = xml.querySelectorAll("item");

            items.forEach((item, index) => {
                if (index > 2) return; // –ó–µ–º–∏ —Å–∞–º–æ —Ç–æ–ø 3 –≤–µ—Å—Ç–∏ –æ–¥ —Å–µ–∫–æ—ò —Å–∞—ò—Ç
                
                allArticles.push({
                    title: item.querySelector("title")?.textContent || "–ë–µ–∑ –Ω–∞—Å–ª–æ–≤",
                    link: item.querySelector("link")?.textContent || "#",
                    summary: item.querySelector("description")?.textContent?.replace(/<[^>]*>?/gm, '').substring(0, 120) + "...",
                    source_name: source.name,
                    region: source.region,
                    published: item.querySelector("pubDate")?.textContent || new Date().toISOString(),
                    category: source.category || "News"
                });
            });

            // –û—Å–≤–µ–∂–∏ –≥–æ –±—Ä–æ—ò—á–∞–Ω–∏–∫–æ—Ç
            document.getElementById('articleCount').textContent = allArticles.length;
            renderNews(); // –¶—Ä—Ç–∞—ò –≥–∏ –≤–µ—Å—Ç–∏—Ç–µ –≤–µ–¥–Ω–∞—à —à—Ç–æ–º —ú–µ —Å—Ç–∏–≥–Ω–∞—Ç
            
        } catch (e) {
            console.error("–ì—Ä–µ—à–∫–∞ —Å–æ –∏–∑–≤–æ—Ä–æ—Ç: " + source.name);
        }
    }
    
    document.getElementById('lastUpdate').textContent = '‚è±Ô∏è –ü–æ—Å–ª–µ–¥–Ω–æ: ' + new Date().toLocaleTimeString('mk-MK');
    renderTicker();
    renderTrending();
}

function renderNews() {
    const newsGrid = document.getElementById('newsGrid');
    let filtered = allArticles;
    
    if (currentRegion !== 'all') {
        filtered = allArticles.filter(a => a.region.includes(currentRegion.replace('üèîÔ∏è ', '').replace('üåç ', '')));
    }

    if (filtered.length === 0) return;

    newsGrid.innerHTML = filtered.map((a, i) => `
        <div class="nc" onclick="window.open('${a.link}', '_blank')">
            <div class="nc-img" style="background:${GRADIENTS[i % 5]}">
                <span class="emo">üì∞</span>
                <div class="nc-bdg">${a.category}</div>
                <div class="nc-src-badge">${a.source_name}</div>
            </div>
            <div class="nc-body">
                <div class="nc-meta">üìÖ ${new Date(a.published).toLocaleDateString('mk-MK')} ‚Ä¢ ${a.region}</div>
                <h3 class="nc-ttl">${a.title}</h3>
                <p class="nc-exc">${a.summary}</p>
                <div class="nc-ft">
                    <span class="nc-src">üì° ${a.source_name}</span>
                    <button class="nc-link">–ü—Ä–æ—á–∏—Ç–∞—ò ‚Üí</button>
                </div>
            </div>
        </div>
    `).join('');
}

function renderTicker() {
    const ticker = document.getElementById('ticker');
    const items = allArticles.slice(0, 10).map(a => `<span class="tick-i">üì∞ ${a.title}</span>`).join('');
    ticker.innerHTML = items + items;
}

function renderTrending() {
    const trend = document.getElementById('trending');
    trend.innerHTML = allArticles.slice(0, 5).map((a, i) => `
        <div class="trd" onclick="window.open('${a.link}', '_blank')">
            <div class="trd-n">${(i + 1).toString().padStart(2, '0')}</div>
            <div class="trd-t">${a.title}</div>
        </div>
    `).join('');
}

// –§–∏–ª—Ç—Ä–∏—Ä–∞—ö–µ –ø–æ —Ä–µ–≥–∏–æ–Ω
document.getElementById('navBar').addEventListener('click', e => {
    const btn = e.target.closest('.nav-btn');
    if (!btn) return;
    currentRegion = btn.dataset.r;
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.toggle('on', b === btn));
    renderNews();
});

// –°–¢–ê–†–¢–£–í–ê–à!
loadNews();
// –ê–≤—Ç–æ–º–∞—Ç—Å–∫–æ –æ—Å–≤–µ–∂—É–≤–∞—ö–µ –Ω–∞ —Å–µ–∫–æ–∏ 10 –º–∏–Ω—É—Ç–∏ (–Ω–µ –Ω–∞ 4 —Å–µ–∫—É–Ω–¥–∏!)
setInterval(loadNews, 600000); 
</script>
